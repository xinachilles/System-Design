# 10.3.2

Created: 2023-09-23 11:02:41 -0600

Modified: 2023-10-22 17:25:31 -0600

---

Summary

The speaker discusses creating an authorizer for API Gateway hosted APIs using Amazon Cognito and a SAM template, demonstrating the process of setting up, testing, and authenticating API requests with JWT tokens obtained from Cognito.

Facts

- A SAM template on the speaker's laptop has created an API, consisting of a Lambda function called "Hello World function" and an HTTP API with a stage called "prod".
- The API, when curled, returns the string "hello" unauthenticated.
- Amazon Cognito is configured to host sign-in and sign-up screens for the application.
- Upon signing in, Cognito verifies the account and returns an ID token and an access token.



from jwt.io

- The access token, a JWT token, contains information about the identity returned from Cognito, including the issuer, client ID, type of token, scopes attached, and expiry dates.
- The speaker plans to use this access token to authenticate against the API by sending it to API Gateway.
- The SAM template is configured to create an authorizer in API Gateway, defining the identity source as the "authorization header" and specifying JWT configuration, including the issuer and the audience.
- API Gateway verifies tokens based on the specified claims and uses a public key from a well-known location to verify the signature on the token.
- After deploying the updated SAM template, the API Gateway has the newly defined authorizer, "GeneralAuth", associated with the "/hello" route.
- Attempts to curl the route without passing the authorization header now result in an "unauthorized" response.
- The access token from Cognito is stored in an environment variable and passed along in an authorization header to authorize the request to the "/hello" route, successfully returning the response from the Lambda function.
- The process involved updating the API Gateway API to have a JWT authorizer and associating it with the "/hello" route, then using a sample application to sign in using Cognito and authorize the request with the received access token.







![Creating an authorizer for API Gateway hosted APIs The definition and deployment of API Gateway is defined using AWS Serverless Application Model (AWS SAM). The demonstration uses curl to invoke the API. The API functionality is implemented through a Lambda function defined using a python script hello.py. START > ](../../../media/AWS-Developing-Serverless-Solutions-on-AWS-Module-3-10.3.2-image1.png){width="5.0in" height="2.5208333333333335in"}



![step 1 SAM template for API deployment The API is created using a SAM template, which defines the API Resources, Lambda function to run the API functionality and outputs generated by the API. 2 ](../../../media/AWS-Developing-Serverless-Solutions-on-AWS-Module-3-10.3.2-image2.png){width="5.0in" height="2.3819444444444446in"}



![step 2 curl commands to invoke the API The demonstration uses two curl commands, once before defining the authorizer for the API and once after defining the authorizer for the API. The authorizer is defined using the environment variable AT. 1 ](../../../media/AWS-Developing-Serverless-Solutions-on-AWS-Module-3-10.3.2-image3.png){width="5.0in" height="2.3958333333333335in"}



![You came across two scripts and some curl commands in the demo. The code scripts are a SAM template and a Lambda function. • The SAM template deploys the API, which in turn is implemented a using a Lambda function. • The Lambda function is implemented using python. Following code is the SAM template used in the demo. ](../../../media/AWS-Developing-Serverless-Solutions-on-AWS-Module-3-10.3.2-image4.png){width="5.0in" height="1.9652777777777777in"}



![](../../../media/AWS-Developing-Serverless-Solutions-on-AWS-Module-3-10.3.2-image5.png){width="5.0in" height="4.368055555555555in"}



![](../../../media/AWS-Developing-Serverless-Solutions-on-AWS-Module-3-10.3.2-image6.png){width="5.0in" height="0.9583333333333334in"}



![](../../../media/AWS-Developing-Serverless-Solutions-on-AWS-Module-3-10.3.2-image7.png){width="5.0in" height="3.8125in"}



![That wraps the module on authentication and authorization in serverless applications. A Knowledge Check follows this module. ](../../../media/AWS-Developing-Serverless-Solutions-on-AWS-Module-3-10.3.2-image8.png){width="5.0in" height="0.9583333333333334in"}








